<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.16.0/dist/favicon.ico" />
    <!-- Preload is necessary because we show these images when we disconnect from the server,
    but at that point we cannot load these images from the server -->
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.16.0/dist/assets/gradient-yHQUC_QB.png" as="image" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.16.0/dist/assets/noise-60BoTA8O.png" as="image" />
    <!-- Preload the fonts -->
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.16.0/dist/assets/Lora-VariableFont_wght-B2ootaw-.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.16.0/dist/assets/PTSans-Regular-CxL0S8W7.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.16.0/dist/assets/PTSans-Bold-D9fedIX3.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.16.0/dist/assets/FiraMono-Regular-BTCkDNvf.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.16.0/dist/assets/FiraMono-Medium-DU3aDxX5.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.16.0/dist/assets/FiraMono-Bold-CLVRCuM9.ttf" as="font" crossorigin="anonymous" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="a marimo app" />
    <link rel="apple-touch-icon" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.16.0/dist/apple-touch-icon.png" />
    <link rel="manifest" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.16.0/dist/manifest.json" />

    <script data-marimo="true">
      function __resizeIframe(obj) {
        var scrollbarHeight = 20; // Max between windows, mac, and linux

        function setHeight() {
          var element = obj.contentWindow.document.documentElement;
          // If there is no vertical scrollbar, we don't need to resize the iframe
          if (element.scrollHeight === element.clientHeight) {
            return;
          }

          // Create a new height that includes the scrollbar height if it's visible
          var hasHorizontalScrollbar = element.scrollWidth > element.clientWidth;
          var newHeight = element.scrollHeight + (hasHorizontalScrollbar ? scrollbarHeight : 0);

          // Only update the height if it's different from the current height
          if (obj.style.height !== `${newHeight}px`) {
            obj.style.height = `${newHeight}px`;
          }
        }

        // Resize the iframe to the height of the content and bottom scrollbar height
        setHeight();

        // Resize the iframe when the content changes
        const resizeObserver = new ResizeObserver((entries) => {
          setHeight();
        });
        resizeObserver.observe(obj.contentWindow.document.body);
      }
    </script>
    <marimo-filename hidden>notes.py</marimo-filename>
    <!-- TODO(Trevor): Legacy, required by VS Code plugin. Remove when plugin is updated (see marimo/server/_templates/template.py) -->
    <marimo-version data-version="{{ version }}" hidden></marimo-version>
    <marimo-user-config data-config="{{ user_config }}" hidden></marimo-user-config>
    <marimo-server-token data-token="{{ server_token }}" hidden></marimo-server-token>
    <!-- /TODO -->
    <title>notes</title>
    <script type="module" crossorigin crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.16.0/dist/assets/index-DKEudB02.js"></script>
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.16.0/dist/assets/index-Cx0bsY1w.css">
  
<script data-marimo="true">
    window.__MARIMO_STATIC__ = {};
    window.__MARIMO_STATIC__.files = {};
</script>
</head>
  <body>
    <div id="root"></div>
    <!-- This is a portal for the data editor to render in -->
    <div id="portal" data-testid="glide-portal" style="position: fixed; left: 0; top: 0; z-index: 9999"></div>
    <script data-marimo="true">
      window.__MARIMO_MOUNT_CONFIG__ = {
            "filename": "notes.py",
            "mode": "read",
            "version": "0.16.0",
            "serverToken": "static",
            "config": {"ai": {"models": {"custom_models": [], "displayed_models": []}}, "completion": {"activate_on_typing": true, "copilot": false}, "display": {"cell_output": "above", "code_editor_font_size": 14, "dataframes": "rich", "default_table_max_columns": 50, "default_table_page_size": 10, "default_width": "medium", "reference_highlighting": false, "theme": "light"}, "formatting": {"line_length": 79}, "keymap": {"overrides": {}, "preset": "default"}, "language_servers": {"pylsp": {"enable_flake8": false, "enable_mypy": true, "enable_pydocstyle": false, "enable_pyflakes": false, "enable_pylint": false, "enable_ruff": true, "enabled": true}}, "package_management": {"manager": "pip"}, "runtime": {"auto_instantiate": true, "auto_reload": "off", "default_sql_output": "auto", "on_cell_change": "autorun", "output_max_bytes": 8000000, "reactive_tests": true, "std_stream_max_bytes": 1000000, "watcher_on_save": "lazy"}, "save": {"autosave": "after_delay", "autosave_delay": 1000, "format_on_save": false}, "server": {"browser": "default", "follow_symlink": false}, "snippets": {"custom_paths": [], "include_default_snippets": true}},
            "configOverrides": {},
            "appConfig": {"sql_output": "auto", "width": "medium"},
            "view": {"showAppCode": true},
            "notebook": {"cells": [{"code": "import marimo as mo\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns", "code_hash": "e76e8dbe4d9bf74eff98fef5f002130b", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Hbol", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\n# Machine Learning Zoomcamp\n\n## Module 5: **Deployment**\n\"\"\"\n)", "code_hash": "07c233464013afa4d4625a5bd786d950", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "MJUe", "name": "_"}, {"code": "repository_root = (\n    \"https://github.com/DataTalksClub/machine-learning-zoomcamp/blob/master/\"\n)\n\nchapters = pd.DataFrame(\n    [\n        {\n            \"title\": \"Session Overview\",\n            \"youtube_id\": \"agIFak9A3m8\",\n            \"contents\": repository_root + \"05-deployment/01-intro.md\",\n        },\n        {\n            \"title\": \"Saving and Loading the Model\",\n            \"youtube_id\": \"EJpqZ7OlwFU\",\n            \"contents\": repository_root + \"05-deployment/02-pickle.md\",\n        },\n        {\n            \"title\": \"Web Services: Introduction to Flask\",\n            \"youtube_id\": \"W7ubna1Rfv8\",\n            \"contents\": repository_root + \"05-deployment/03-flask-intro.md\",\n        },\n        {\n            \"title\": \"Serving the Churn Model with Flask\",\n            \"youtube_id\": \"Q7ZWPgPnRz8\",\n            \"contents\": repository_root + \"05-deployment/04-flask-deployment.md\",\n        },\n        {\n            \"title\": \"Python Virtual Environment: Pipenv\",\n            \"youtube_id\": \"BMXh8JGROHM\",\n            \"contents\": repository_root + \"05-deployment/05-pipenv.md\",\n        },\n        {\n            \"title\": \"Environment Management: Docker\",\n            \"youtube_id\": \"wAtyYZ6zvAs\",\n            \"contents\": repository_root + \"05-deployment/06-docker.md\",\n        },\n        {\n            \"title\": \"Deployment to the Cloud: AWS Elastic Beanstalk (optional)\",\n            \"youtube_id\": \"HGPJ4ekhcLg\",\n            \"contents\": repository_root + \"05-deployment/07-aws-eb.md\",\n        },\n        {\n            \"title\": \"Summary\",\n            \"youtube_id\": \"sSAqYSk7Br4\",\n            \"contents\": repository_root + \"05-deployment/08-summary.md\",\n        },\n        {\n            \"title\": \"Explore More\",\n            \"contents\": repository_root + \"05-deployment/09-explore-more.md\",\n        },\n    ]\n)\n\nchapters.insert(\n    loc=0,\n    column=\"snapshot\",\n    value=\"https://img.youtube.com/vi/\"\n    + chapters.youtube_id.astype(str)\n    + \"/hqdefault.jpg\",\n)\nchapters.insert(\n    loc=2,\n    column=\"youtube\",\n    value=\"https://youtube.com/watch?v=\" + chapters.youtube_id.astype(str),\n)\n\nvideos = chapters[chapters[\"youtube_id\"].notnull()]\nvideos[[\"snapshot\", \"title\", \"youtube\"]]", "code_hash": "945b3a2c8bf730670bc88fa61d82d19b", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "vblA", "name": "_"}, {"code": "contents = chapters[chapters[\"contents\"].notnull()]\ncontents[[\"title\", \"contents\"]]", "code_hash": "1d3036664588742ca99aa99004e53a08", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "bkHC", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\n## Previous Sessions Refresh\n\nIn the previous modules we created a model that predicted if a customer was about to churn or not. This time we'll learn how to save the module and serve it in a production environment. But first we have to reproduce the steps to build the model.\n\n#### Read and Standardize the Dataset\n\"\"\"\n)", "code_hash": "59b1bc663927697fc7ad30ecb15920d9", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "lEQa", "name": "_"}, {"code": "def standardize_column_names(dataframe: pd.DataFrame) -> pd.DataFrame:\n    standardized = dataframe.copy()\n    standardized.columns = standardized.columns.str.lower().str.replace(' ', '_')\n\n    return standardized\n\ndef get_cateogorical_columns(dataframe: pd.DataFrame) -> list[str]:\n    return list(list(dataframe.dtypes[dataframe.dtypes == 'object'].index))\n\ndef standardize_categorical_values(dataframe: pd.DataFrame) -> pd.DataFrame:\n    standardized = dataframe.copy()\n\n    for column in get_cateogorical_columns(standardized):\n        standardized[column] = standardized[column].str.lower().str.replace(' ', '_')\n\n    return standardized\n\ndef standardize_non_categorical_values(dataframe: pd.DataFrame) -> pd.DataFrame:\n    totalcharges = pd.to_numeric(df_standardized.totalcharges, errors='coerce')\n    df_standardized.totalcharges = totalcharges.fillna(0)\n\n    return df_standardized\n\ndf_raw = pd.read_csv(\"module-3/data/customer-churn.csv\")\ndf_standardized = standardize_column_names(df_raw)\ndf_standardized = standardize_categorical_values(df_standardized)\ndf_standardized = standardize_non_categorical_values(df_standardized)\n\ndf_standardized.head()", "code_hash": "37ddcdb72e4e18a064b5225c004f8371", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "PKri", "name": "_"}, {"code": "mo.md(r\"\"\"#### Setup the Validation Framework\"\"\")", "code_hash": "765d6709e1fecaf0c8fb1bfc870d7c82", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "Xref", "name": "_"}, {"code": "from sklearn.model_selection import train_test_split\n\ndef split_dataframe(dataframe: pd.DataFrame) -> pd.DataFrame:\n    full_train, test = train_test_split(dataframe, test_size=0.2, random_state=1)\n    train, val = train_test_split(full_train, test_size=0.25, random_state=1)\n\n    return train, val, test, full_train\n\ndf_train, df_val, df_test, df_full = split_dataframe(df_standardized)\n\ndf_train = df_train.reset_index(drop=True)\ndf_val = df_val.reset_index(drop=True)\ndf_test = df_test.reset_index(drop=True)\ndf_full = df_full.reset_index(drop=True)\n\n{\n    \"df_train\": len(df_train),\n    \"df_val\": len(df_val),\n    \"df_test\": len(df_test),\n    \"df_full\": len(df_full),\n}", "code_hash": "4be289f9a84c6a975d1e4f774a5f668c", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "SFPL", "name": "_"}, {"code": "mo.md(r\"\"\"#### Prepare the Features and Target Tensors\"\"\")", "code_hash": "bdd5e72664770c101e1189d0a4c50189", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "BYtC", "name": "_"}, {"code": "from sklearn.feature_extraction import DictVectorizer\n\nnumerical_columns = [\"tenure\", \"monthlycharges\", \"totalcharges\"]\n\ncategorical_columns = [\n    'gender', 'seniorcitizen', 'partner', 'dependents',\n    'phoneservice', 'multiplelines', 'internetservice', 'onlinesecurity',\n    'onlinebackup', 'deviceprotection', 'techsupport', 'streamingtv',\n    'streamingmovies', 'contract', 'paperlessbilling', 'paymentmethod'\n]\n\ndef get_full_trained_vectorizer(dataframe: pd.DataFrame) -> list[dict]:\n    copy = dataframe.copy()\n    del copy[\"churn\"]\n    dictionary = copy.to_dict(orient=\"records\")\n\n    dict_vectorizer = DictVectorizer(sparse=False)\n    dict_vectorizer.fit(dictionary)\n\n    return dict_vectorizer, dictionary\n\ndef get_features_and_target(dataframe: pd.DataFrame, dict_vectorizer: DictVectorizer, dictionary):\n    X = dict_vectorizer.transform(dictionary)\n    y = dataframe.churn == \"yes\"\n\n    return X, y\n\ndict_vectorizer_full, dictionary_full = get_full_trained_vectorizer(df_full)\nX_full, y_full = get_features_and_target(df_full, dict_vectorizer_full, dictionary_full)\n\ndictionary_val = df_val[numerical_columns + categorical_columns].to_dict(orient=\"records\")\nX_val, y_val = get_features_and_target(df_val, dict_vectorizer_full, dictionary_val)\n\n{\n    \"X_full\": len(X_full),\n    \"y_full\": len(y_full),\n    \"X_val\": len(X_val),\n    \"y_val\": len(y_val),\n}", "code_hash": "1aff1629a16a88fb30975158988f2c0f", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "RGSE", "name": "_"}, {"code": "mo.md(r\"\"\"## Saving and Loading the Model\"\"\")", "code_hash": "c2df609f290eb430293f560766c2da28", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "Kclp", "name": "_"}, {"code": "import pickle\nimport os\nfrom sklearn.linear_model import LogisticRegression\n\nmodel_file = \"module-5/data/model-weights.bin\"\n\ndef load_model():\n    with open(model_file, \"rb\") as f_in:\n        (model_loaded, dict_vectorizer_full_loaded) = pickle.load(f_in)\n    return model_loaded, dict_vectorizer_full_loaded\n\ndef train_and_save_model():\n    model = LogisticRegression(max_iter=5000)\n    model.fit(X_full, y_full)\n    with open(model_file, \"wb\") as f_out:\n        pickle.dump((model, dict_vectorizer_full), f_out)\n\n    return model, dict_vectorizer_full\n\nif not os.path.isfile(\"module-5/data/model-weights.bin\"):\n    train_and_save_model()\n\nmodel_loaded, dict_vectorizer_full_loaded = load_model()\n\n{\n    model_loaded.score(X_val, y_val)\n}", "code_hash": "7dfc51d487206e1fb2a519a2f648b7aa", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "emfo", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\nTo facilitate the deployment, a the code necessary to train, save and load the model has been extracted to these files:\n\n* [model.py](https://github.com/elcapo/ml-zoomcamp-notes-and-homework/blob/main/module-5/model_package/model.py)\n* [train.py](https://github.com/elcapo/ml-zoomcamp-notes-and-homework/blob/main/module-5/model_package/train.py)\n* [predict.py](https://github.com/elcapo/ml-zoomcamp-notes-and-homework/blob/main/module-5/model_package/predict.py)\n\nBefore running any of these programs, first make sure that you have loaded the virtual environment for the course:\n\n```bash\nsource .venv/bin/activate\ncd module-5/\n```\n\n### Train\n\nTo run the training:\n\n```bash\npython -m model_package.train\n```\n\n### Predict\n\nTo run a prediction:\n\n```bash\npython -m model_package.predict\n```\n\"\"\"\n)", "code_hash": "b846d221ab06e53642c96c9f5c27cbd4", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "Hstk", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\n## Web Services: Introduction to Flask\n\nThe REST API server has been implemented in [api.py](https://github.com/elcapo/ml-zoomcamp-notes-and-homework/blob/main/module-5/model_package/api.py) a single method that responds **PONG** when the `/ping` method is accessed via GET.\n\nTo run it:\n\n```bash\npython -m model_package.api\n```\n\nWhen you run it, you'll see a message telling you where the service is listening. Something like:\n\n> Running on http://127.0.0.1:5000\n\nYou can use that address to test the service:\n\n```bash\ncurl http://127.0.0.1:5000/ping\n```\n\"\"\"\n)", "code_hash": "22e80ab05312aa2252dd872d6d3e387f", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "nWHF", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\n## Serving the Churn Model with Flask\n\nIn this chapter we added a `/predict` method to our API that responds to POST requests with JSONs similar to the dictionaries that we were obtaining from the dataset:\n\"\"\"\n)", "code_hash": "a28966b5ace8ec6e4985a0218fbf5c6d", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "iLit", "name": "_"}, {"code": "import json\n\nprint(json.dumps(df_val[1:2].to_dict(orient='records')[0], indent=4))", "code_hash": "178f2449c5c4f11cbec4456885d5cfc3", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "ZHCJ", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\n... and returns the corresponding prediction:\n\n```json\n{\n  \"customer\": {\n    \"churn\": \"no\",\n    \"contract\": \"month-to-month\",\n    \"customerid\": \"3645-deygf\",\n    \"dependents\": \"yes\",\n    \"deviceprotection\": \"no_internet_service\",\n    \"gender\": \"male\",\n    \"internetservice\": \"no\",\n    \"monthlycharges\": 20.75,\n    \"multiplelines\": \"no\",\n    \"onlinebackup\": \"no_internet_service\",\n    \"onlinesecurity\": \"no_internet_service\",\n    \"paperlessbilling\": \"no\",\n    \"partner\": \"no\",\n    \"paymentmethod\": \"mailed_check\",\n    \"phoneservice\": \"yes\",\n    \"seniorcitizen\": 0,\n    \"streamingmovies\": \"no_internet_service\",\n    \"streamingtv\": \"no_internet_service\",\n    \"techsupport\": \"no_internet_service\",\n    \"tenure\": 1,\n    \"totalcharges\": 20.75\n  },\n  \"predicted_churn\": false\n}\n```\n\"\"\"\n)", "code_hash": "0aeaf2c4680dc68953d71c31bb654d75", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "ROlb", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\n## Python Virtual Environment\n\nFor this project's dependencies we used a **requirements.txt** with the dependencies listed:\n\n```\npandas==2.3.2\nscikit-learn==1.7.2\nflask==3.1.2\n```\n\nWe also added a README with some installation instructions.\n\n### Create and Activate a Virtual Environment\n\n```bash\npython -m venv .venv\nsource .venv/bin/activate\n```\n\n### Install Dependencies\n\n```bash\npip install -r requirements.txt\n```\n\"\"\"\n)", "code_hash": "a51e6a6344b3048c8424fb73e3b95f25", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "qnkX", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\n## Environment Management: Docker\n\nThe next step to isolate our services is Docker. With Docker we can automate the deployment of our programs including their dependencies in isolated environments. What gives us the warrant that our environments would be similar in development and production.\n\"\"\"\n)", "code_hash": "0f03f5473042fec97679e6613d67da81", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "TqIu", "name": "_"}], "metadata": {"marimo_version": "0.16.0"}, "version": "1"},
            "session": {"cells": [{"code_hash": "e76e8dbe4d9bf74eff98fef5f002130b", "console": [], "id": "Hbol", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "07c233464013afa4d4625a5bd786d950", "console": [], "id": "MJUe", "outputs": [{"data": {"text/html": "<span class=\"markdown prose dark:prose-invert\"><h1 id=\"machine-learning-zoomcamp\">Machine Learning Zoomcamp</h1>\n<h2 id=\"module-5-deployment\">Module 5: <strong>Deployment</strong></h2></span>"}, "type": "data"}]}, {"code_hash": "945b3a2c8bf730670bc88fa61d82d19b", "console": [], "id": "vblA", "outputs": [{"data": {"text/html": "<marimo-ui-element object-id='vblA-0' random-id='5d8ff380-f12d-2a1e-3930-79dc25eaf58c'><marimo-table data-initial-value='[]' data-label='null' data-data='&quot;[{&#92;&quot;&#92;&quot;:0,&#92;&quot;snapshot&#92;&quot;:&#92;&quot;https://img.youtube.com/vi/agIFak9A3m8/hqdefault.jpg&#92;&quot;,&#92;&quot;title&#92;&quot;:&#92;&quot;Session Overview&#92;&quot;,&#92;&quot;youtube&#92;&quot;:&#92;&quot;https://youtube.com/watch?v=agIFak9A3m8&#92;&quot;},{&#92;&quot;&#92;&quot;:1,&#92;&quot;snapshot&#92;&quot;:&#92;&quot;https://img.youtube.com/vi/EJpqZ7OlwFU/hqdefault.jpg&#92;&quot;,&#92;&quot;title&#92;&quot;:&#92;&quot;Saving and Loading the Model&#92;&quot;,&#92;&quot;youtube&#92;&quot;:&#92;&quot;https://youtube.com/watch?v=EJpqZ7OlwFU&#92;&quot;},{&#92;&quot;&#92;&quot;:2,&#92;&quot;snapshot&#92;&quot;:&#92;&quot;https://img.youtube.com/vi/W7ubna1Rfv8/hqdefault.jpg&#92;&quot;,&#92;&quot;title&#92;&quot;:&#92;&quot;Web Services: Introduction to Flask&#92;&quot;,&#92;&quot;youtube&#92;&quot;:&#92;&quot;https://youtube.com/watch?v=W7ubna1Rfv8&#92;&quot;},{&#92;&quot;&#92;&quot;:3,&#92;&quot;snapshot&#92;&quot;:&#92;&quot;https://img.youtube.com/vi/Q7ZWPgPnRz8/hqdefault.jpg&#92;&quot;,&#92;&quot;title&#92;&quot;:&#92;&quot;Serving the Churn Model with Flask&#92;&quot;,&#92;&quot;youtube&#92;&quot;:&#92;&quot;https://youtube.com/watch?v=Q7ZWPgPnRz8&#92;&quot;},{&#92;&quot;&#92;&quot;:4,&#92;&quot;snapshot&#92;&quot;:&#92;&quot;https://img.youtube.com/vi/BMXh8JGROHM/hqdefault.jpg&#92;&quot;,&#92;&quot;title&#92;&quot;:&#92;&quot;Python Virtual Environment: Pipenv&#92;&quot;,&#92;&quot;youtube&#92;&quot;:&#92;&quot;https://youtube.com/watch?v=BMXh8JGROHM&#92;&quot;},{&#92;&quot;&#92;&quot;:5,&#92;&quot;snapshot&#92;&quot;:&#92;&quot;https://img.youtube.com/vi/wAtyYZ6zvAs/hqdefault.jpg&#92;&quot;,&#92;&quot;title&#92;&quot;:&#92;&quot;Environment Management: Docker&#92;&quot;,&#92;&quot;youtube&#92;&quot;:&#92;&quot;https://youtube.com/watch?v=wAtyYZ6zvAs&#92;&quot;},{&#92;&quot;&#92;&quot;:6,&#92;&quot;snapshot&#92;&quot;:&#92;&quot;https://img.youtube.com/vi/HGPJ4ekhcLg/hqdefault.jpg&#92;&quot;,&#92;&quot;title&#92;&quot;:&#92;&quot;Deployment to the Cloud: AWS Elastic Beanstalk (optional)&#92;&quot;,&#92;&quot;youtube&#92;&quot;:&#92;&quot;https://youtube.com/watch?v=HGPJ4ekhcLg&#92;&quot;},{&#92;&quot;&#92;&quot;:7,&#92;&quot;snapshot&#92;&quot;:&#92;&quot;https://img.youtube.com/vi/sSAqYSk7Br4/hqdefault.jpg&#92;&quot;,&#92;&quot;title&#92;&quot;:&#92;&quot;Summary&#92;&quot;,&#92;&quot;youtube&#92;&quot;:&#92;&quot;https://youtube.com/watch?v=sSAqYSk7Br4&#92;&quot;}]&quot;' data-total-rows='8' data-total-columns='3' data-max-columns='50' data-banner-text='&quot;&quot;' data-pagination='true' data-page-size='10' data-field-types='[[&quot;snapshot&quot;,[&quot;string&quot;,&quot;object&quot;]],[&quot;title&quot;,[&quot;string&quot;,&quot;object&quot;]],[&quot;youtube&quot;,[&quot;string&quot;,&quot;object&quot;]]]' data-show-filters='true' data-show-download='true' data-show-column-summaries='false' data-show-data-types='true' data-show-page-size-selector='true' data-show-column-explorer='true' data-show-chart-builder='true' data-row-headers='[[&quot;&quot;,[&quot;integer&quot;,&quot;int64&quot;]]]' data-has-stable-row-id='false' data-lazy='false' data-preload='false'></marimo-table></marimo-ui-element>"}, "type": "data"}]}, {"code_hash": "1d3036664588742ca99aa99004e53a08", "console": [], "id": "bkHC", "outputs": [{"data": {"text/html": "<marimo-ui-element object-id='bkHC-0' random-id='6b9f6250-6256-d94f-3e85-8ae9aa7298f0'><marimo-table data-initial-value='[]' data-label='null' data-data='&quot;[{&#92;&quot;title&#92;&quot;:&#92;&quot;Session Overview&#92;&quot;,&#92;&quot;contents&#92;&quot;:&#92;&quot;https://github.com/DataTalksClub/machine-learning-zoomcamp/blob/master/05-deployment/01-intro.md&#92;&quot;},{&#92;&quot;title&#92;&quot;:&#92;&quot;Saving and Loading the Model&#92;&quot;,&#92;&quot;contents&#92;&quot;:&#92;&quot;https://github.com/DataTalksClub/machine-learning-zoomcamp/blob/master/05-deployment/02-pickle.md&#92;&quot;},{&#92;&quot;title&#92;&quot;:&#92;&quot;Web Services: Introduction to Flask&#92;&quot;,&#92;&quot;contents&#92;&quot;:&#92;&quot;https://github.com/DataTalksClub/machine-learning-zoomcamp/blob/master/05-deployment/03-flask-intro.md&#92;&quot;},{&#92;&quot;title&#92;&quot;:&#92;&quot;Serving the Churn Model with Flask&#92;&quot;,&#92;&quot;contents&#92;&quot;:&#92;&quot;https://github.com/DataTalksClub/machine-learning-zoomcamp/blob/master/05-deployment/04-flask-deployment.md&#92;&quot;},{&#92;&quot;title&#92;&quot;:&#92;&quot;Python Virtual Environment: Pipenv&#92;&quot;,&#92;&quot;contents&#92;&quot;:&#92;&quot;https://github.com/DataTalksClub/machine-learning-zoomcamp/blob/master/05-deployment/05-pipenv.md&#92;&quot;},{&#92;&quot;title&#92;&quot;:&#92;&quot;Environment Management: Docker&#92;&quot;,&#92;&quot;contents&#92;&quot;:&#92;&quot;https://github.com/DataTalksClub/machine-learning-zoomcamp/blob/master/05-deployment/06-docker.md&#92;&quot;},{&#92;&quot;title&#92;&quot;:&#92;&quot;Deployment to the Cloud: AWS Elastic Beanstalk (optional)&#92;&quot;,&#92;&quot;contents&#92;&quot;:&#92;&quot;https://github.com/DataTalksClub/machine-learning-zoomcamp/blob/master/05-deployment/07-aws-eb.md&#92;&quot;},{&#92;&quot;title&#92;&quot;:&#92;&quot;Summary&#92;&quot;,&#92;&quot;contents&#92;&quot;:&#92;&quot;https://github.com/DataTalksClub/machine-learning-zoomcamp/blob/master/05-deployment/08-summary.md&#92;&quot;},{&#92;&quot;title&#92;&quot;:&#92;&quot;Explore More&#92;&quot;,&#92;&quot;contents&#92;&quot;:&#92;&quot;https://github.com/DataTalksClub/machine-learning-zoomcamp/blob/master/05-deployment/09-explore-more.md&#92;&quot;}]&quot;' data-total-rows='9' data-total-columns='2' data-max-columns='50' data-banner-text='&quot;&quot;' data-pagination='true' data-page-size='10' data-field-types='[[&quot;title&quot;,[&quot;string&quot;,&quot;object&quot;]],[&quot;contents&quot;,[&quot;string&quot;,&quot;object&quot;]]]' data-show-filters='true' data-show-download='true' data-show-column-summaries='false' data-show-data-types='true' data-show-page-size-selector='true' data-show-column-explorer='true' data-show-chart-builder='true' data-row-headers='[]' data-has-stable-row-id='false' data-lazy='false' data-preload='false'></marimo-table></marimo-ui-element>"}, "type": "data"}]}, {"code_hash": "59b1bc663927697fc7ad30ecb15920d9", "console": [], "id": "lEQa", "outputs": [{"data": {"text/html": "<span class=\"markdown prose dark:prose-invert\"><h2 id=\"previous-sessions-refresh\">Previous Sessions Refresh</h2>\n<span class=\"paragraph\">In the previous modules we created a model that predicted if a customer was about to churn or not. This time we'll learn how to save the module and serve it in a production environment. But first we have to reproduce the steps to build the model.</span>\n<h4 id=\"read-and-standardize-the-dataset\">Read and Standardize the Dataset</h4></span>"}, "type": "data"}]}, {"code_hash": "37ddcdb72e4e18a064b5225c004f8371", "console": [], "id": "PKri", "outputs": [{"data": {"text/html": "<marimo-ui-element object-id='PKri-0' random-id='e4035668-d85e-c34d-62f9-32a18f9b652f'><marimo-table data-initial-value='[]' data-label='null' data-data='&quot;[{&#92;&quot;customerid&#92;&quot;:&#92;&quot;7590-vhveg&#92;&quot;,&#92;&quot;gender&#92;&quot;:&#92;&quot;female&#92;&quot;,&#92;&quot;seniorcitizen&#92;&quot;:0,&#92;&quot;partner&#92;&quot;:&#92;&quot;yes&#92;&quot;,&#92;&quot;dependents&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;tenure&#92;&quot;:1,&#92;&quot;phoneservice&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;multiplelines&#92;&quot;:&#92;&quot;no_phone_service&#92;&quot;,&#92;&quot;internetservice&#92;&quot;:&#92;&quot;dsl&#92;&quot;,&#92;&quot;onlinesecurity&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;onlinebackup&#92;&quot;:&#92;&quot;yes&#92;&quot;,&#92;&quot;deviceprotection&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;techsupport&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;streamingtv&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;streamingmovies&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;contract&#92;&quot;:&#92;&quot;month-to-month&#92;&quot;,&#92;&quot;paperlessbilling&#92;&quot;:&#92;&quot;yes&#92;&quot;,&#92;&quot;paymentmethod&#92;&quot;:&#92;&quot;electronic_check&#92;&quot;,&#92;&quot;monthlycharges&#92;&quot;:29.85,&#92;&quot;totalcharges&#92;&quot;:29.85,&#92;&quot;churn&#92;&quot;:&#92;&quot;no&#92;&quot;},{&#92;&quot;customerid&#92;&quot;:&#92;&quot;5575-gnvde&#92;&quot;,&#92;&quot;gender&#92;&quot;:&#92;&quot;male&#92;&quot;,&#92;&quot;seniorcitizen&#92;&quot;:0,&#92;&quot;partner&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;dependents&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;tenure&#92;&quot;:34,&#92;&quot;phoneservice&#92;&quot;:&#92;&quot;yes&#92;&quot;,&#92;&quot;multiplelines&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;internetservice&#92;&quot;:&#92;&quot;dsl&#92;&quot;,&#92;&quot;onlinesecurity&#92;&quot;:&#92;&quot;yes&#92;&quot;,&#92;&quot;onlinebackup&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;deviceprotection&#92;&quot;:&#92;&quot;yes&#92;&quot;,&#92;&quot;techsupport&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;streamingtv&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;streamingmovies&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;contract&#92;&quot;:&#92;&quot;one_year&#92;&quot;,&#92;&quot;paperlessbilling&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;paymentmethod&#92;&quot;:&#92;&quot;mailed_check&#92;&quot;,&#92;&quot;monthlycharges&#92;&quot;:56.95,&#92;&quot;totalcharges&#92;&quot;:1889.5,&#92;&quot;churn&#92;&quot;:&#92;&quot;no&#92;&quot;},{&#92;&quot;customerid&#92;&quot;:&#92;&quot;3668-qpybk&#92;&quot;,&#92;&quot;gender&#92;&quot;:&#92;&quot;male&#92;&quot;,&#92;&quot;seniorcitizen&#92;&quot;:0,&#92;&quot;partner&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;dependents&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;tenure&#92;&quot;:2,&#92;&quot;phoneservice&#92;&quot;:&#92;&quot;yes&#92;&quot;,&#92;&quot;multiplelines&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;internetservice&#92;&quot;:&#92;&quot;dsl&#92;&quot;,&#92;&quot;onlinesecurity&#92;&quot;:&#92;&quot;yes&#92;&quot;,&#92;&quot;onlinebackup&#92;&quot;:&#92;&quot;yes&#92;&quot;,&#92;&quot;deviceprotection&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;techsupport&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;streamingtv&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;streamingmovies&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;contract&#92;&quot;:&#92;&quot;month-to-month&#92;&quot;,&#92;&quot;paperlessbilling&#92;&quot;:&#92;&quot;yes&#92;&quot;,&#92;&quot;paymentmethod&#92;&quot;:&#92;&quot;mailed_check&#92;&quot;,&#92;&quot;monthlycharges&#92;&quot;:53.85,&#92;&quot;totalcharges&#92;&quot;:108.15,&#92;&quot;churn&#92;&quot;:&#92;&quot;yes&#92;&quot;},{&#92;&quot;customerid&#92;&quot;:&#92;&quot;7795-cfocw&#92;&quot;,&#92;&quot;gender&#92;&quot;:&#92;&quot;male&#92;&quot;,&#92;&quot;seniorcitizen&#92;&quot;:0,&#92;&quot;partner&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;dependents&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;tenure&#92;&quot;:45,&#92;&quot;phoneservice&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;multiplelines&#92;&quot;:&#92;&quot;no_phone_service&#92;&quot;,&#92;&quot;internetservice&#92;&quot;:&#92;&quot;dsl&#92;&quot;,&#92;&quot;onlinesecurity&#92;&quot;:&#92;&quot;yes&#92;&quot;,&#92;&quot;onlinebackup&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;deviceprotection&#92;&quot;:&#92;&quot;yes&#92;&quot;,&#92;&quot;techsupport&#92;&quot;:&#92;&quot;yes&#92;&quot;,&#92;&quot;streamingtv&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;streamingmovies&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;contract&#92;&quot;:&#92;&quot;one_year&#92;&quot;,&#92;&quot;paperlessbilling&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;paymentmethod&#92;&quot;:&#92;&quot;bank_transfer_(automatic)&#92;&quot;,&#92;&quot;monthlycharges&#92;&quot;:42.3,&#92;&quot;totalcharges&#92;&quot;:1840.75,&#92;&quot;churn&#92;&quot;:&#92;&quot;no&#92;&quot;},{&#92;&quot;customerid&#92;&quot;:&#92;&quot;9237-hqitu&#92;&quot;,&#92;&quot;gender&#92;&quot;:&#92;&quot;female&#92;&quot;,&#92;&quot;seniorcitizen&#92;&quot;:0,&#92;&quot;partner&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;dependents&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;tenure&#92;&quot;:2,&#92;&quot;phoneservice&#92;&quot;:&#92;&quot;yes&#92;&quot;,&#92;&quot;multiplelines&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;internetservice&#92;&quot;:&#92;&quot;fiber_optic&#92;&quot;,&#92;&quot;onlinesecurity&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;onlinebackup&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;deviceprotection&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;techsupport&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;streamingtv&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;streamingmovies&#92;&quot;:&#92;&quot;no&#92;&quot;,&#92;&quot;contract&#92;&quot;:&#92;&quot;month-to-month&#92;&quot;,&#92;&quot;paperlessbilling&#92;&quot;:&#92;&quot;yes&#92;&quot;,&#92;&quot;paymentmethod&#92;&quot;:&#92;&quot;electronic_check&#92;&quot;,&#92;&quot;monthlycharges&#92;&quot;:70.7,&#92;&quot;totalcharges&#92;&quot;:151.65,&#92;&quot;churn&#92;&quot;:&#92;&quot;yes&#92;&quot;}]&quot;' data-total-rows='5' data-total-columns='21' data-max-columns='50' data-banner-text='&quot;&quot;' data-pagination='true' data-page-size='10' data-field-types='[[&quot;customerid&quot;,[&quot;string&quot;,&quot;object&quot;]],[&quot;gender&quot;,[&quot;string&quot;,&quot;object&quot;]],[&quot;seniorcitizen&quot;,[&quot;integer&quot;,&quot;int64&quot;]],[&quot;partner&quot;,[&quot;string&quot;,&quot;object&quot;]],[&quot;dependents&quot;,[&quot;string&quot;,&quot;object&quot;]],[&quot;tenure&quot;,[&quot;integer&quot;,&quot;int64&quot;]],[&quot;phoneservice&quot;,[&quot;string&quot;,&quot;object&quot;]],[&quot;multiplelines&quot;,[&quot;string&quot;,&quot;object&quot;]],[&quot;internetservice&quot;,[&quot;string&quot;,&quot;object&quot;]],[&quot;onlinesecurity&quot;,[&quot;string&quot;,&quot;object&quot;]],[&quot;onlinebackup&quot;,[&quot;string&quot;,&quot;object&quot;]],[&quot;deviceprotection&quot;,[&quot;string&quot;,&quot;object&quot;]],[&quot;techsupport&quot;,[&quot;string&quot;,&quot;object&quot;]],[&quot;streamingtv&quot;,[&quot;string&quot;,&quot;object&quot;]],[&quot;streamingmovies&quot;,[&quot;string&quot;,&quot;object&quot;]],[&quot;contract&quot;,[&quot;string&quot;,&quot;object&quot;]],[&quot;paperlessbilling&quot;,[&quot;string&quot;,&quot;object&quot;]],[&quot;paymentmethod&quot;,[&quot;string&quot;,&quot;object&quot;]],[&quot;monthlycharges&quot;,[&quot;number&quot;,&quot;float64&quot;]],[&quot;totalcharges&quot;,[&quot;number&quot;,&quot;float64&quot;]],[&quot;churn&quot;,[&quot;string&quot;,&quot;object&quot;]]]' data-show-filters='true' data-show-download='true' data-show-column-summaries='false' data-show-data-types='true' data-show-page-size-selector='false' data-show-column-explorer='true' data-show-chart-builder='true' data-row-headers='[]' data-has-stable-row-id='false' data-lazy='false' data-preload='false'></marimo-table></marimo-ui-element>"}, "type": "data"}]}, {"code_hash": "765d6709e1fecaf0c8fb1bfc870d7c82", "console": [], "id": "Xref", "outputs": [{"data": {"text/html": "<span class=\"markdown prose dark:prose-invert\"><h4 id=\"setup-the-validation-framework\">Setup the Validation Framework</h4></span>"}, "type": "data"}]}, {"code_hash": "4be289f9a84c6a975d1e4f774a5f668c", "console": [{"name": "stderr", "text": "<span class=\"codehilite\"><div class=\"highlight\"><pre><span></span><span class=\"gt\">Traceback (most recent call last):</span>\n  File <span class=\"nb\">&quot;/home/carlos/Programming/Courses/ml-zoomcamp/.venv/lib/python3.13/site-packages/marimo/_runtime/executor.py&quot;</span>, line <span class=\"m\">138</span>, in <span class=\"n\">execute_cell</span>\n<span class=\"w\">    </span><span class=\"n\">exec</span><span class=\"p\">(</span><span class=\"n\">cell</span><span class=\"o\">.</span><span class=\"n\">body</span><span class=\"p\">,</span> <span class=\"n\">glbls</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"pm\">~~~~^^^^^^^^^^^^^^^^^^</span>\n  File <span class=\"nb\">&quot;/tmp/user/1000/marimo_284227/__marimo__cell_SFPL_.py&quot;</span>, line <span class=\"m\">1</span>, in <span class=\"n\">&lt;module&gt;</span>\n<span class=\"w\">    </span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">sklearn.model_selection</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">train_test_split</span>\n<span class=\"gr\">ModuleNotFoundError</span>: <span class=\"n\">No module named &#39;sklearn&#39;</span>\n</pre></div>\n</span>", "type": "stream"}], "id": "SFPL", "outputs": [{"ename": "exception", "evalue": "No module named 'sklearn'", "traceback": [], "type": "error"}]}, {"code_hash": "bdd5e72664770c101e1189d0a4c50189", "console": [], "id": "BYtC", "outputs": [{"data": {"text/html": "<span class=\"markdown prose dark:prose-invert\"><h4 id=\"prepare-the-features-and-target-tensors\">Prepare the Features and Target Tensors</h4></span>"}, "type": "data"}]}, {"code_hash": "1aff1629a16a88fb30975158988f2c0f", "console": [], "id": "RGSE", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (ModuleNotFoundError): ", "traceback": [], "type": "error"}]}, {"code_hash": "c2df609f290eb430293f560766c2da28", "console": [], "id": "Kclp", "outputs": [{"data": {"text/html": "<span class=\"markdown prose dark:prose-invert\"><h2 id=\"saving-and-loading-the-model\">Saving and Loading the Model</h2></span>"}, "type": "data"}]}, {"code_hash": "7dfc51d487206e1fb2a519a2f648b7aa", "console": [], "id": "emfo", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (ModuleNotFoundError): ", "traceback": [], "type": "error"}]}, {"code_hash": "b846d221ab06e53642c96c9f5c27cbd4", "console": [], "id": "Hstk", "outputs": [{"data": {"text/html": "<span class=\"markdown prose dark:prose-invert\"><span class=\"paragraph\">To facilitate the deployment, a the code necessary to train, save and load the model has been extracted to these files:</span>\n<ul>\n<li><a href=\"https://github.com/elcapo/ml-zoomcamp-notes-and-homework/blob/main/module-5/model_package/model.py\" rel=\"noopener\" target=\"_blank\">model.py</a></li>\n<li><a href=\"https://github.com/elcapo/ml-zoomcamp-notes-and-homework/blob/main/module-5/model_package/train.py\" rel=\"noopener\" target=\"_blank\">train.py</a></li>\n<li><a href=\"https://github.com/elcapo/ml-zoomcamp-notes-and-homework/blob/main/module-5/model_package/predict.py\" rel=\"noopener\" target=\"_blank\">predict.py</a></li>\n</ul>\n<span class=\"paragraph\">Before running any of these programs, first make sure that you have loaded the virtual environment for the course:</span>\n<div class=\"language-bash codehilite\"><pre><span></span><code><span class=\"nb\">source</span><span class=\"w\"> </span>.venv/bin/activate\n<span class=\"nb\">cd</span><span class=\"w\"> </span>module-5/\n</code></pre></div>\n<h3 id=\"train\">Train</h3>\n<span class=\"paragraph\">To run the training:</span>\n<div class=\"language-bash codehilite\"><pre><span></span><code>python<span class=\"w\"> </span>-m<span class=\"w\"> </span>model_package.train\n</code></pre></div>\n<h3 id=\"predict\">Predict</h3>\n<span class=\"paragraph\">To run a prediction:</span>\n<div class=\"language-bash codehilite\"><pre><span></span><code>python<span class=\"w\"> </span>-m<span class=\"w\"> </span>model_package.predict\n</code></pre></div></span>"}, "type": "data"}]}, {"code_hash": "22e80ab05312aa2252dd872d6d3e387f", "console": [], "id": "nWHF", "outputs": [{"data": {"text/html": "<span class=\"markdown prose dark:prose-invert\"><h2 id=\"web-services-introduction-to-flask\">Web Services: Introduction to Flask</h2>\n<span class=\"paragraph\">The REST API server has been implemented in <a href=\"https://github.com/elcapo/ml-zoomcamp-notes-and-homework/blob/main/module-5/model_package/api.py\" rel=\"noopener\" target=\"_blank\">api.py</a> a single method that responds <strong>PONG</strong> when the <code>/ping</code> method is accessed via GET.</span>\n<span class=\"paragraph\">To run it:</span>\n<div class=\"language-bash codehilite\"><pre><span></span><code>python<span class=\"w\"> </span>-m<span class=\"w\"> </span>model_package.api\n</code></pre></div>\n<span class=\"paragraph\">When you run it, you'll see a message telling you where the service is listening. Something like:</span>\n<blockquote>\n<span class=\"paragraph\">Running on <a href=\"http://127.0.0.1:5000\" rel=\"noopener\" target=\"_blank\">http://127.0.0.1:5000</a></span>\n</blockquote>\n<span class=\"paragraph\">You can use that address to test the service:</span>\n<div class=\"language-bash codehilite\"><pre><span></span><code>curl<span class=\"w\"> </span>http://127.0.0.1:5000/ping\n</code></pre></div></span>"}, "type": "data"}]}, {"code_hash": "a28966b5ace8ec6e4985a0218fbf5c6d", "console": [], "id": "iLit", "outputs": [{"data": {"text/html": "<span class=\"markdown prose dark:prose-invert\"><h2 id=\"serving-the-churn-model-with-flask\">Serving the Churn Model with Flask</h2>\n<span class=\"paragraph\">In this chapter we added a <code>/predict</code> method to our API that responds to POST requests with JSONs similar to the dictionaries that we were obtaining from the dataset:</span></span>"}, "type": "data"}]}, {"code_hash": "178f2449c5c4f11cbec4456885d5cfc3", "console": [], "id": "ZHCJ", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (ModuleNotFoundError): ", "traceback": [], "type": "error"}]}, {"code_hash": "0aeaf2c4680dc68953d71c31bb654d75", "console": [], "id": "ROlb", "outputs": [{"data": {"text/html": "<span class=\"markdown prose dark:prose-invert\"><span class=\"paragraph\">... and returns the corresponding prediction:</span>\n<div class=\"language-json codehilite\"><pre><span></span><code><span class=\"p\">{</span>\n<span class=\"w\">  </span><span class=\"nt\">&quot;customer&quot;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"nt\">&quot;churn&quot;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">&quot;no&quot;</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"nt\">&quot;contract&quot;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">&quot;month-to-month&quot;</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"nt\">&quot;customerid&quot;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">&quot;3645-deygf&quot;</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"nt\">&quot;dependents&quot;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">&quot;yes&quot;</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"nt\">&quot;deviceprotection&quot;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">&quot;no_internet_service&quot;</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"nt\">&quot;gender&quot;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">&quot;male&quot;</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"nt\">&quot;internetservice&quot;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">&quot;no&quot;</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"nt\">&quot;monthlycharges&quot;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mf\">20.75</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"nt\">&quot;multiplelines&quot;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">&quot;no&quot;</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"nt\">&quot;onlinebackup&quot;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">&quot;no_internet_service&quot;</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"nt\">&quot;onlinesecurity&quot;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">&quot;no_internet_service&quot;</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"nt\">&quot;paperlessbilling&quot;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">&quot;no&quot;</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"nt\">&quot;partner&quot;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">&quot;no&quot;</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"nt\">&quot;paymentmethod&quot;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">&quot;mailed_check&quot;</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"nt\">&quot;phoneservice&quot;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">&quot;yes&quot;</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"nt\">&quot;seniorcitizen&quot;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"nt\">&quot;streamingmovies&quot;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">&quot;no_internet_service&quot;</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"nt\">&quot;streamingtv&quot;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">&quot;no_internet_service&quot;</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"nt\">&quot;techsupport&quot;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">&quot;no_internet_service&quot;</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"nt\">&quot;tenure&quot;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"nt\">&quot;totalcharges&quot;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mf\">20.75</span>\n<span class=\"w\">  </span><span class=\"p\">},</span>\n<span class=\"w\">  </span><span class=\"nt\">&quot;predicted_churn&quot;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kc\">false</span>\n<span class=\"p\">}</span>\n</code></pre></div></span>"}, "type": "data"}]}, {"code_hash": "a51e6a6344b3048c8424fb73e3b95f25", "console": [], "id": "qnkX", "outputs": [{"data": {"text/html": "<span class=\"markdown prose dark:prose-invert\"><h2 id=\"python-virtual-environment\">Python Virtual Environment</h2>\n<span class=\"paragraph\">For this project's dependencies we used a <strong>requirements.txt</strong> with the dependencies listed:</span>\n<div class=\"language-text codehilite\"><pre><span></span><code>pandas==2.3.2\nscikit-learn==1.7.2\nflask==3.1.2\n</code></pre></div>\n<span class=\"paragraph\">We also added a README with some installation instructions.</span>\n<h3 id=\"create-and-activate-a-virtual-environment\">Create and Activate a Virtual Environment</h3>\n<div class=\"language-bash codehilite\"><pre><span></span><code>python<span class=\"w\"> </span>-m<span class=\"w\"> </span>venv<span class=\"w\"> </span>.venv\n<span class=\"nb\">source</span><span class=\"w\"> </span>.venv/bin/activate\n</code></pre></div>\n<h3 id=\"install-dependencies\">Install Dependencies</h3>\n<div class=\"language-bash codehilite\"><pre><span></span><code>pip<span class=\"w\"> </span>install<span class=\"w\"> </span>-r<span class=\"w\"> </span>requirements.txt\n</code></pre></div></span>"}, "type": "data"}]}, {"code_hash": "0f03f5473042fec97679e6613d67da81", "console": [], "id": "TqIu", "outputs": [{"data": {"text/html": "<span class=\"markdown prose dark:prose-invert\"><h2 id=\"environment-management-docker\">Environment Management: Docker</h2>\n<span class=\"paragraph\">The next step to isolate our services is Docker. With Docker we can automate the deployment of our programs including their dependencies in isolated environments. What gives us the warrant that our environments would be similar in development and production.</span></span>"}, "type": "data"}]}], "metadata": {"marimo_version": "0.16.0"}, "version": "1"},
            "runtimeConfig": null,
        };
    </script>
  
<marimo-code hidden="">
    import%20marimo%0A%0A__generated_with%20%3D%20%220.16.0%22%0Aapp%20%3D%20marimo.App(width%3D%22medium%22)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20import%20marimo%20as%20mo%0A%20%20%20%20import%20pandas%20as%20pd%0A%20%20%20%20import%20numpy%20as%20np%0A%20%20%20%20import%20matplotlib.pyplot%20as%20plt%0A%20%20%20%20import%20seaborn%20as%20sns%0A%20%20%20%20return%20mo%2C%20pd%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%23%20Machine%20Learning%20Zoomcamp%0A%0A%20%20%20%20%23%23%20Module%205%3A%20**Deployment**%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(pd)%3A%0A%20%20%20%20repository_root%20%3D%20(%0A%20%20%20%20%20%20%20%20%22https%3A%2F%2Fgithub.com%2FDataTalksClub%2Fmachine-learning-zoomcamp%2Fblob%2Fmaster%2F%22%0A%20%20%20%20)%0A%0A%20%20%20%20chapters%20%3D%20pd.DataFrame(%0A%20%20%20%20%20%20%20%20%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22title%22%3A%20%22Session%20Overview%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22youtube_id%22%3A%20%22agIFak9A3m8%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22contents%22%3A%20repository_root%20%2B%20%2205-deployment%2F01-intro.md%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22title%22%3A%20%22Saving%20and%20Loading%20the%20Model%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22youtube_id%22%3A%20%22EJpqZ7OlwFU%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22contents%22%3A%20repository_root%20%2B%20%2205-deployment%2F02-pickle.md%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22title%22%3A%20%22Web%20Services%3A%20Introduction%20to%20Flask%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22youtube_id%22%3A%20%22W7ubna1Rfv8%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22contents%22%3A%20repository_root%20%2B%20%2205-deployment%2F03-flask-intro.md%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22title%22%3A%20%22Serving%20the%20Churn%20Model%20with%20Flask%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22youtube_id%22%3A%20%22Q7ZWPgPnRz8%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22contents%22%3A%20repository_root%20%2B%20%2205-deployment%2F04-flask-deployment.md%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22title%22%3A%20%22Python%20Virtual%20Environment%3A%20Pipenv%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22youtube_id%22%3A%20%22BMXh8JGROHM%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22contents%22%3A%20repository_root%20%2B%20%2205-deployment%2F05-pipenv.md%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22title%22%3A%20%22Environment%20Management%3A%20Docker%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22youtube_id%22%3A%20%22wAtyYZ6zvAs%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22contents%22%3A%20repository_root%20%2B%20%2205-deployment%2F06-docker.md%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22title%22%3A%20%22Deployment%20to%20the%20Cloud%3A%20AWS%20Elastic%20Beanstalk%20(optional)%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22youtube_id%22%3A%20%22HGPJ4ekhcLg%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22contents%22%3A%20repository_root%20%2B%20%2205-deployment%2F07-aws-eb.md%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22title%22%3A%20%22Summary%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22youtube_id%22%3A%20%22sSAqYSk7Br4%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22contents%22%3A%20repository_root%20%2B%20%2205-deployment%2F08-summary.md%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22title%22%3A%20%22Explore%20More%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22contents%22%3A%20repository_root%20%2B%20%2205-deployment%2F09-explore-more.md%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%5D%0A%20%20%20%20)%0A%0A%20%20%20%20chapters.insert(%0A%20%20%20%20%20%20%20%20loc%3D0%2C%0A%20%20%20%20%20%20%20%20column%3D%22snapshot%22%2C%0A%20%20%20%20%20%20%20%20value%3D%22https%3A%2F%2Fimg.youtube.com%2Fvi%2F%22%0A%20%20%20%20%20%20%20%20%2B%20chapters.youtube_id.astype(str)%0A%20%20%20%20%20%20%20%20%2B%20%22%2Fhqdefault.jpg%22%2C%0A%20%20%20%20)%0A%20%20%20%20chapters.insert(%0A%20%20%20%20%20%20%20%20loc%3D2%2C%0A%20%20%20%20%20%20%20%20column%3D%22youtube%22%2C%0A%20%20%20%20%20%20%20%20value%3D%22https%3A%2F%2Fyoutube.com%2Fwatch%3Fv%3D%22%20%2B%20chapters.youtube_id.astype(str)%2C%0A%20%20%20%20)%0A%0A%20%20%20%20videos%20%3D%20chapters%5Bchapters%5B%22youtube_id%22%5D.notnull()%5D%0A%20%20%20%20videos%5B%5B%22snapshot%22%2C%20%22title%22%2C%20%22youtube%22%5D%5D%0A%20%20%20%20return%20(chapters%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(chapters)%3A%0A%20%20%20%20contents%20%3D%20chapters%5Bchapters%5B%22contents%22%5D.notnull()%5D%0A%20%20%20%20contents%5B%5B%22title%22%2C%20%22contents%22%5D%5D%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%23%23%20Previous%20Sessions%20Refresh%0A%0A%20%20%20%20In%20the%20previous%20modules%20we%20created%20a%20model%20that%20predicted%20if%20a%20customer%20was%20about%20to%20churn%20or%20not.%20This%20time%20we'll%20learn%20how%20to%20save%20the%20module%20and%20serve%20it%20in%20a%20production%20environment.%20But%20first%20we%20have%20to%20reproduce%20the%20steps%20to%20build%20the%20model.%0A%0A%20%20%20%20%23%23%23%23%20Read%20and%20Standardize%20the%20Dataset%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(pd)%3A%0A%20%20%20%20def%20standardize_column_names(dataframe%3A%20pd.DataFrame)%20-%3E%20pd.DataFrame%3A%0A%20%20%20%20%20%20%20%20standardized%20%3D%20dataframe.copy()%0A%20%20%20%20%20%20%20%20standardized.columns%20%3D%20standardized.columns.str.lower().str.replace('%20'%2C%20'_')%0A%0A%20%20%20%20%20%20%20%20return%20standardized%0A%0A%20%20%20%20def%20get_cateogorical_columns(dataframe%3A%20pd.DataFrame)%20-%3E%20list%5Bstr%5D%3A%0A%20%20%20%20%20%20%20%20return%20list(list(dataframe.dtypes%5Bdataframe.dtypes%20%3D%3D%20'object'%5D.index))%0A%0A%20%20%20%20def%20standardize_categorical_values(dataframe%3A%20pd.DataFrame)%20-%3E%20pd.DataFrame%3A%0A%20%20%20%20%20%20%20%20standardized%20%3D%20dataframe.copy()%0A%0A%20%20%20%20%20%20%20%20for%20column%20in%20get_cateogorical_columns(standardized)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20standardized%5Bcolumn%5D%20%3D%20standardized%5Bcolumn%5D.str.lower().str.replace('%20'%2C%20'_')%0A%0A%20%20%20%20%20%20%20%20return%20standardized%0A%0A%20%20%20%20def%20standardize_non_categorical_values(dataframe%3A%20pd.DataFrame)%20-%3E%20pd.DataFrame%3A%0A%20%20%20%20%20%20%20%20totalcharges%20%3D%20pd.to_numeric(df_standardized.totalcharges%2C%20errors%3D'coerce')%0A%20%20%20%20%20%20%20%20df_standardized.totalcharges%20%3D%20totalcharges.fillna(0)%0A%0A%20%20%20%20%20%20%20%20return%20df_standardized%0A%0A%20%20%20%20df_raw%20%3D%20pd.read_csv(%22module-3%2Fdata%2Fcustomer-churn.csv%22)%0A%20%20%20%20df_standardized%20%3D%20standardize_column_names(df_raw)%0A%20%20%20%20df_standardized%20%3D%20standardize_categorical_values(df_standardized)%0A%20%20%20%20df_standardized%20%3D%20standardize_non_categorical_values(df_standardized)%0A%0A%20%20%20%20df_standardized.head()%0A%20%20%20%20return%20(df_standardized%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%23%23%23%23%20Setup%20the%20Validation%20Framework%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(df_standardized%2C%20pd)%3A%0A%20%20%20%20from%20sklearn.model_selection%20import%20train_test_split%0A%0A%20%20%20%20def%20split_dataframe(dataframe%3A%20pd.DataFrame)%20-%3E%20pd.DataFrame%3A%0A%20%20%20%20%20%20%20%20full_train%2C%20test%20%3D%20train_test_split(dataframe%2C%20test_size%3D0.2%2C%20random_state%3D1)%0A%20%20%20%20%20%20%20%20train%2C%20val%20%3D%20train_test_split(full_train%2C%20test_size%3D0.25%2C%20random_state%3D1)%0A%0A%20%20%20%20%20%20%20%20return%20train%2C%20val%2C%20test%2C%20full_train%0A%0A%20%20%20%20df_train%2C%20df_val%2C%20df_test%2C%20df_full%20%3D%20split_dataframe(df_standardized)%0A%0A%20%20%20%20df_train%20%3D%20df_train.reset_index(drop%3DTrue)%0A%20%20%20%20df_val%20%3D%20df_val.reset_index(drop%3DTrue)%0A%20%20%20%20df_test%20%3D%20df_test.reset_index(drop%3DTrue)%0A%20%20%20%20df_full%20%3D%20df_full.reset_index(drop%3DTrue)%0A%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%22df_train%22%3A%20len(df_train)%2C%0A%20%20%20%20%20%20%20%20%22df_val%22%3A%20len(df_val)%2C%0A%20%20%20%20%20%20%20%20%22df_test%22%3A%20len(df_test)%2C%0A%20%20%20%20%20%20%20%20%22df_full%22%3A%20len(df_full)%2C%0A%20%20%20%20%7D%0A%20%20%20%20return%20df_full%2C%20df_val%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%23%23%23%23%20Prepare%20the%20Features%20and%20Target%20Tensors%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(df_full%2C%20df_val%2C%20pd)%3A%0A%20%20%20%20from%20sklearn.feature_extraction%20import%20DictVectorizer%0A%0A%20%20%20%20numerical_columns%20%3D%20%5B%22tenure%22%2C%20%22monthlycharges%22%2C%20%22totalcharges%22%5D%0A%0A%20%20%20%20categorical_columns%20%3D%20%5B%0A%20%20%20%20%20%20%20%20'gender'%2C%20'seniorcitizen'%2C%20'partner'%2C%20'dependents'%2C%0A%20%20%20%20%20%20%20%20'phoneservice'%2C%20'multiplelines'%2C%20'internetservice'%2C%20'onlinesecurity'%2C%0A%20%20%20%20%20%20%20%20'onlinebackup'%2C%20'deviceprotection'%2C%20'techsupport'%2C%20'streamingtv'%2C%0A%20%20%20%20%20%20%20%20'streamingmovies'%2C%20'contract'%2C%20'paperlessbilling'%2C%20'paymentmethod'%0A%20%20%20%20%5D%0A%0A%20%20%20%20def%20get_full_trained_vectorizer(dataframe%3A%20pd.DataFrame)%20-%3E%20list%5Bdict%5D%3A%0A%20%20%20%20%20%20%20%20copy%20%3D%20dataframe.copy()%0A%20%20%20%20%20%20%20%20del%20copy%5B%22churn%22%5D%0A%20%20%20%20%20%20%20%20dictionary%20%3D%20copy.to_dict(orient%3D%22records%22)%0A%0A%20%20%20%20%20%20%20%20dict_vectorizer%20%3D%20DictVectorizer(sparse%3DFalse)%0A%20%20%20%20%20%20%20%20dict_vectorizer.fit(dictionary)%0A%0A%20%20%20%20%20%20%20%20return%20dict_vectorizer%2C%20dictionary%0A%0A%20%20%20%20def%20get_features_and_target(dataframe%3A%20pd.DataFrame%2C%20dict_vectorizer%3A%20DictVectorizer%2C%20dictionary)%3A%0A%20%20%20%20%20%20%20%20X%20%3D%20dict_vectorizer.transform(dictionary)%0A%20%20%20%20%20%20%20%20y%20%3D%20dataframe.churn%20%3D%3D%20%22yes%22%0A%0A%20%20%20%20%20%20%20%20return%20X%2C%20y%0A%0A%20%20%20%20dict_vectorizer_full%2C%20dictionary_full%20%3D%20get_full_trained_vectorizer(df_full)%0A%20%20%20%20X_full%2C%20y_full%20%3D%20get_features_and_target(df_full%2C%20dict_vectorizer_full%2C%20dictionary_full)%0A%0A%20%20%20%20dictionary_val%20%3D%20df_val%5Bnumerical_columns%20%2B%20categorical_columns%5D.to_dict(orient%3D%22records%22)%0A%20%20%20%20X_val%2C%20y_val%20%3D%20get_features_and_target(df_val%2C%20dict_vectorizer_full%2C%20dictionary_val)%0A%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%22X_full%22%3A%20len(X_full)%2C%0A%20%20%20%20%20%20%20%20%22y_full%22%3A%20len(y_full)%2C%0A%20%20%20%20%20%20%20%20%22X_val%22%3A%20len(X_val)%2C%0A%20%20%20%20%20%20%20%20%22y_val%22%3A%20len(y_val)%2C%0A%20%20%20%20%7D%0A%20%20%20%20return%20X_full%2C%20X_val%2C%20dict_vectorizer_full%2C%20y_full%2C%20y_val%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%23%23%20Saving%20and%20Loading%20the%20Model%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(X_full%2C%20X_val%2C%20dict_vectorizer_full%2C%20y_full%2C%20y_val)%3A%0A%20%20%20%20import%20pickle%0A%20%20%20%20import%20os%0A%20%20%20%20from%20sklearn.linear_model%20import%20LogisticRegression%0A%0A%20%20%20%20model_file%20%3D%20%22module-5%2Fdata%2Fmodel-weights.bin%22%0A%0A%20%20%20%20def%20load_model()%3A%0A%20%20%20%20%20%20%20%20with%20open(model_file%2C%20%22rb%22)%20as%20f_in%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20(model_loaded%2C%20dict_vectorizer_full_loaded)%20%3D%20pickle.load(f_in)%0A%20%20%20%20%20%20%20%20return%20model_loaded%2C%20dict_vectorizer_full_loaded%0A%0A%20%20%20%20def%20train_and_save_model()%3A%0A%20%20%20%20%20%20%20%20model%20%3D%20LogisticRegression(max_iter%3D5000)%0A%20%20%20%20%20%20%20%20model.fit(X_full%2C%20y_full)%0A%20%20%20%20%20%20%20%20with%20open(model_file%2C%20%22wb%22)%20as%20f_out%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20pickle.dump((model%2C%20dict_vectorizer_full)%2C%20f_out)%0A%0A%20%20%20%20%20%20%20%20return%20model%2C%20dict_vectorizer_full%0A%0A%20%20%20%20if%20not%20os.path.isfile(%22module-5%2Fdata%2Fmodel-weights.bin%22)%3A%0A%20%20%20%20%20%20%20%20train_and_save_model()%0A%0A%20%20%20%20model_loaded%2C%20dict_vectorizer_full_loaded%20%3D%20load_model()%0A%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20model_loaded.score(X_val%2C%20y_val)%0A%20%20%20%20%7D%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20To%20facilitate%20the%20deployment%2C%20a%20the%20code%20necessary%20to%20train%2C%20save%20and%20load%20the%20model%20has%20been%20extracted%20to%20these%20files%3A%0A%0A%20%20%20%20*%20%5Bmodel.py%5D(https%3A%2F%2Fgithub.com%2Felcapo%2Fml-zoomcamp-notes-and-homework%2Fblob%2Fmain%2Fmodule-5%2Fmodel_package%2Fmodel.py)%0A%20%20%20%20*%20%5Btrain.py%5D(https%3A%2F%2Fgithub.com%2Felcapo%2Fml-zoomcamp-notes-and-homework%2Fblob%2Fmain%2Fmodule-5%2Fmodel_package%2Ftrain.py)%0A%20%20%20%20*%20%5Bpredict.py%5D(https%3A%2F%2Fgithub.com%2Felcapo%2Fml-zoomcamp-notes-and-homework%2Fblob%2Fmain%2Fmodule-5%2Fmodel_package%2Fpredict.py)%0A%0A%20%20%20%20Before%20running%20any%20of%20these%20programs%2C%20first%20make%20sure%20that%20you%20have%20loaded%20the%20virtual%20environment%20for%20the%20course%3A%0A%0A%20%20%20%20%60%60%60bash%0A%20%20%20%20source%20.venv%2Fbin%2Factivate%0A%20%20%20%20cd%20module-5%2F%0A%20%20%20%20%60%60%60%0A%0A%20%20%20%20%23%23%23%20Train%0A%0A%20%20%20%20To%20run%20the%20training%3A%0A%0A%20%20%20%20%60%60%60bash%0A%20%20%20%20python%20-m%20model_package.train%0A%20%20%20%20%60%60%60%0A%0A%20%20%20%20%23%23%23%20Predict%0A%0A%20%20%20%20To%20run%20a%20prediction%3A%0A%0A%20%20%20%20%60%60%60bash%0A%20%20%20%20python%20-m%20model_package.predict%0A%20%20%20%20%60%60%60%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%23%23%20Web%20Services%3A%20Introduction%20to%20Flask%0A%0A%20%20%20%20The%20REST%20API%20server%20has%20been%20implemented%20in%20%5Bapi.py%5D(https%3A%2F%2Fgithub.com%2Felcapo%2Fml-zoomcamp-notes-and-homework%2Fblob%2Fmain%2Fmodule-5%2Fmodel_package%2Fapi.py)%20a%20single%20method%20that%20responds%20**PONG**%20when%20the%20%60%2Fping%60%20method%20is%20accessed%20via%20GET.%0A%0A%20%20%20%20To%20run%20it%3A%0A%0A%20%20%20%20%60%60%60bash%0A%20%20%20%20python%20-m%20model_package.api%0A%20%20%20%20%60%60%60%0A%0A%20%20%20%20When%20you%20run%20it%2C%20you'll%20see%20a%20message%20telling%20you%20where%20the%20service%20is%20listening.%20Something%20like%3A%0A%0A%20%20%20%20%3E%20Running%20on%20http%3A%2F%2F127.0.0.1%3A5000%0A%0A%20%20%20%20You%20can%20use%20that%20address%20to%20test%20the%20service%3A%0A%0A%20%20%20%20%60%60%60bash%0A%20%20%20%20curl%20http%3A%2F%2F127.0.0.1%3A5000%2Fping%0A%20%20%20%20%60%60%60%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%23%23%20Serving%20the%20Churn%20Model%20with%20Flask%0A%0A%20%20%20%20In%20this%20chapter%20we%20added%20a%20%60%2Fpredict%60%20method%20to%20our%20API%20that%20responds%20to%20POST%20requests%20with%20JSONs%20similar%20to%20the%20dictionaries%20that%20we%20were%20obtaining%20from%20the%20dataset%3A%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(df_val)%3A%0A%20%20%20%20import%20json%0A%0A%20%20%20%20print(json.dumps(df_val%5B1%3A2%5D.to_dict(orient%3D'records')%5B0%5D%2C%20indent%3D4))%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20...%20and%20returns%20the%20corresponding%20prediction%3A%0A%0A%20%20%20%20%60%60%60json%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%22customer%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%22churn%22%3A%20%22no%22%2C%0A%20%20%20%20%20%20%20%20%22contract%22%3A%20%22month-to-month%22%2C%0A%20%20%20%20%20%20%20%20%22customerid%22%3A%20%223645-deygf%22%2C%0A%20%20%20%20%20%20%20%20%22dependents%22%3A%20%22yes%22%2C%0A%20%20%20%20%20%20%20%20%22deviceprotection%22%3A%20%22no_internet_service%22%2C%0A%20%20%20%20%20%20%20%20%22gender%22%3A%20%22male%22%2C%0A%20%20%20%20%20%20%20%20%22internetservice%22%3A%20%22no%22%2C%0A%20%20%20%20%20%20%20%20%22monthlycharges%22%3A%2020.75%2C%0A%20%20%20%20%20%20%20%20%22multiplelines%22%3A%20%22no%22%2C%0A%20%20%20%20%20%20%20%20%22onlinebackup%22%3A%20%22no_internet_service%22%2C%0A%20%20%20%20%20%20%20%20%22onlinesecurity%22%3A%20%22no_internet_service%22%2C%0A%20%20%20%20%20%20%20%20%22paperlessbilling%22%3A%20%22no%22%2C%0A%20%20%20%20%20%20%20%20%22partner%22%3A%20%22no%22%2C%0A%20%20%20%20%20%20%20%20%22paymentmethod%22%3A%20%22mailed_check%22%2C%0A%20%20%20%20%20%20%20%20%22phoneservice%22%3A%20%22yes%22%2C%0A%20%20%20%20%20%20%20%20%22seniorcitizen%22%3A%200%2C%0A%20%20%20%20%20%20%20%20%22streamingmovies%22%3A%20%22no_internet_service%22%2C%0A%20%20%20%20%20%20%20%20%22streamingtv%22%3A%20%22no_internet_service%22%2C%0A%20%20%20%20%20%20%20%20%22techsupport%22%3A%20%22no_internet_service%22%2C%0A%20%20%20%20%20%20%20%20%22tenure%22%3A%201%2C%0A%20%20%20%20%20%20%20%20%22totalcharges%22%3A%2020.75%0A%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%22predicted_churn%22%3A%20false%0A%20%20%20%20%7D%0A%20%20%20%20%60%60%60%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%23%23%20Python%20Virtual%20Environment%0A%0A%20%20%20%20For%20this%20project's%20dependencies%20we%20used%20a%20**requirements.txt**%20with%20the%20dependencies%20listed%3A%0A%0A%20%20%20%20%60%60%60%0A%20%20%20%20pandas%3D%3D2.3.2%0A%20%20%20%20scikit-learn%3D%3D1.7.2%0A%20%20%20%20flask%3D%3D3.1.2%0A%20%20%20%20%60%60%60%0A%0A%20%20%20%20We%20also%20added%20a%20README%20with%20some%20installation%20instructions.%0A%0A%20%20%20%20%23%23%23%20Create%20and%20Activate%20a%20Virtual%20Environment%0A%0A%20%20%20%20%60%60%60bash%0A%20%20%20%20python%20-m%20venv%20.venv%0A%20%20%20%20source%20.venv%2Fbin%2Factivate%0A%20%20%20%20%60%60%60%0A%0A%20%20%20%20%23%23%23%20Install%20Dependencies%0A%0A%20%20%20%20%60%60%60bash%0A%20%20%20%20pip%20install%20-r%20requirements.txt%0A%20%20%20%20%60%60%60%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%23%23%20Environment%20Management%3A%20Docker%0A%0A%20%20%20%20The%20next%20step%20to%20isolate%20our%20services%20is%20Docker.%20With%20Docker%20we%20can%20automate%20the%20deployment%20of%20our%20programs%20including%20their%20dependencies%20in%20isolated%20environments.%20What%20gives%20us%20the%20warrant%20that%20our%20environments%20would%20be%20similar%20in%20development%20and%20production.%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0Aif%20__name__%20%3D%3D%20%22__main__%22%3A%0A%20%20%20%20app.run()%0A
</marimo-code>

<marimo-code-hash hidden="">8207d517d4ccce4b47f1759f6fa7f75f952a049ae8d42744f4cf9e51ab3a8f99</marimo-code-hash>
</body>
</html>
